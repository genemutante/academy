import React, { useEffect, useState } from 'react'
import { PieChart, Pie, Cell, Tooltip, BarChart, XAxis, YAxis, CartesianGrid, Bar, ResponsiveContainer } from 'recharts'
import { Card, CardContent } from '@/components/ui/card'

const COLORS = ['#4ade80', '#facc15', '#f87171']

const DashboardCursos = () => {
  const [dados, setDados] = useState([])

  useEffect(() => {
    fetch('https://academy-tools.netlify.app/data/kpis.json') // substitua por sua API ou JSON local
      .then(res => res.json())
      .then(setDados)
  }, [])

  if (!dados.length) return <div className="text-center mt-20 text-gray-500">Carregando...</div>

  return (
    <div className="p-8 max-w-6xl mx-auto">
      <h1 className="text-3xl font-bold mb-6">üìä Dashboard Geral de Cursos</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {dados.map((curso, i) => (
          <Card key={i} className="shadow-xl">
            <CardContent className="p-6">
              <h2 className="text-xl font-semibold mb-4">{curso.curso}</h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <p><strong>Alunos:</strong> {curso.alunos}</p>
                  <p><strong>% M√©dio Assistido:</strong> {curso.percentual_medio_assistido.toFixed(1)}%</p>
                  <p><strong>Taxa de Conclus√£o:</strong> {curso.taxa_conclusao.toFixed(1)}%</p>
                  <p><strong>Taxa de Abandono:</strong> {curso.taxa_abandono.toFixed(1)}%</p>
                  <p><strong>Tempo M√©dio:</strong> {curso.tempo_medio_formatado}</p>
                  <p><strong>Sess√µes por Aula:</strong> {curso.sessoes_por_aula.toFixed(2)}</p>
                </div>
                <div>
                  <PieChart width={200} height={200}>
                    <Pie
                      dataKey="value"
                      data={[
                        { name: 'Conclu√≠do', value: curso.taxa_conclusao },
                        { name: 'Em Andamento', value: 100 - curso.taxa_conclusao - curso.taxa_abandono },
                        { name: 'Abandono', value: curso.taxa_abandono },
                      ]}
                      cx="50%"
                      cy="50%"
                      outerRadius={80}
                      label
                    >
                      {COLORS.map((color, index) => <Cell key={index} fill={color} />)}
                    </Pie>
                    <Tooltip />
                  </PieChart>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      <div className="mt-10">
        <h2 className="text-2xl font-bold mb-4">‚è±Ô∏è Comparativo de Tempo M√©dio</h2>
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={dados}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="curso" />
            <YAxis />
            <Tooltip />
            <Bar dataKey="tempo_medio_minutos" fill="#3b82f6" />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </div>
  )
}

export default DashboardCursos
