<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel do Aluno</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="container">

  <main id="conteudo" style="margin-top: 2rem;">
    <h2>ðŸŽ“ OlÃ¡, <span id="aluno-nome">estudante</span>!</h2>
    <p>Veja abaixo os cursos disponÃ­veis:</p>
    <div id="cursos" style="margin-top: 1rem;">Carregando...</div>
  </main>

  <script>
    const supabase = window.supabase.createClient(
      'https://bkueljjvhijojzcyodvk.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdWVsamp2aGlqb2p6Y3lvZHZrIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MzUwNTQ4OSwiZXhwIjoyMDU5MDgxNDg5fQ.o-G5KmxoyfQjeNM5e7rbgxpryOHYC9k1OIo9fYzyeYE'
    );

    const params = new URLSearchParams(window.location.search);
    const userId = params.get('user_id');

    if (!userId) {
      document.getElementById('cursos').innerHTML = `<strong>Erro:</strong> ID do aluno nÃ£o encontrado na URL.`;
      throw new Error('user_id ausente');
    }

    async function carregarAluno() {
      const { data, error } = await supabase
        .from('users')
        .select('name')
        .eq('id', userId)
        .single();

      if (data?.name) {
        document.getElementById('aluno-nome').textContent = data.name;
      }
    }

    async function carregarCursos() {
      const { data, error } = await supabase.from('courses').select('*');

      if (error || !data) {
        document.getElementById('cursos').innerHTML = `<strong>Erro ao carregar cursos.</strong>`;
        return;
      }

      const container = document.getElementById('cursos');
      container.innerHTML = '';

      data.forEach(curso => {
        const card = document.createElement('article');
        card.innerHTML = `
          <h3>${curso.title}</h3>
          <p>${curso.description}</p>
         <a href="/curso/${curso.id}?user_id=${userId}" class="...">Acessar curso</a>

        `;
        container.appendChild(card);
      });
    }

    carregarAluno();
    carregarCursos();
  </script>
</body>
</html>
