<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>üéì Portal do Aluno</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background-color: #f7f7f7;
    }
    h1 {
      color: #2c3e50;
    }
    .curso {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .curso h2 {
      margin: 0 0 0.5rem;
    }
    .status {
      margin-top: 0.5rem;
    }
    button {
      padding: 0.5rem 1rem;
      background-color: #27ae60;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      background-color: #95a5a6;
    }
  </style>
</head>
<body>
  <h1>üéì Cursos da Maria Aluna</h1>
  <div id="cursos"></div>

  <script>
    const user_id = "22222222-2222-2222-2222-222222222222"; // Maria Aluna

    async function carregarCursos() {
      const container = document.getElementById("cursos");
      const cursos = await fetch("/.netlify/functions/get-courses", {
        method: "POST"
      }).then(res => res.json());

      for (const curso of cursos) {
        const progresso = await fetch("/.netlify/functions/get-user-progress", {
          method: "POST",
          body: JSON.stringify({
            user_id,
            course_id: curso.id
          }),
          headers: { "Content-Type": "application/json" }
        }).then(res => res.json());

        const concluido = progresso?.completed === true;

        const div = document.createElement("div");
        div.className = "curso";
        div.innerHTML = `
          <h2>${curso.title}</h2>
          <p>${curso.description}</p>
          <div class="status">
            <strong>Status:</strong> ${concluido ? "‚úÖ Conclu√≠do" : "‚ùå N√£o iniciado"}<br/>
            <button ${concluido ? "disabled" : ""} onclick="marcarConcluido('${curso.id}', this)">Concluir curso</button>
          </div>
        `;
        container.appendChild(div);
      }
    }

    async function marcarConcluido(course_id, btn) {
      btn.disabled = true;
      await fetch("/.netlify/functions/save-progress", {
        method: "POST",
        body: JSON.stringify({
          user_id,
          course_id,
          completed: true
        }),
        headers: { "Content-Type": "application/json" }
      });
      btn.parentElement.innerHTML = `<strong>Status:</strong> ‚úÖ Conclu√≠do`;
    }

    carregarCursos();
  </script>
</body>
</html>
