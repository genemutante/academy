<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel do Aluno</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Carlito&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Carlito', sans-serif;
      background-color: #f9fafb;
      padding: 1rem 1.5rem;
    }

    header {
      margin: 1rem auto 1.25rem auto;
      max-width: 820px;
    }

    header h2 {
      font-size: 1.35rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    header p {
      font-size: 1rem;
      color: #4b5563;
      margin: 0.3rem 0 0.8rem 0;
    }

    main {
      max-width: 820px;
      margin: auto;
    }

    section {
      background-color: white;
      border-radius: 10px;
      padding: 1rem 1.25rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    section h3 {
      font-size: 1.15rem;
      margin-bottom: 0.4rem;
    }

    section p {
      font-size: 0.95rem;
      margin-bottom: 0.6rem;
      line-height: 1.4;
    }

    a {
      font-size: 0.95rem;
    }

    @media (max-width: 600px) {
      header h2 {
        font-size: 1.2rem;
      }
      section h3 {
        font-size: 1.05rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h2>üéì Ol√°, <span id="aluno-nome">estudante</span>!</h2>
    <p>Veja abaixo os cursos dispon√≠veis:</p>
  </header>

  <main id="cursos">
    <p>Carregando cursos...</p>
  </main>

  <script>
    const supabase = window.supabase.createClient(
      'https://bkueljjvhijojzcyodvk.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdWVsamp2aGlqb2p6Y3lvZHZrIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MzUwNTQ4OSwiZXhwIjoyMDU5MDgxNDg5fQ.o-G5KmxoyfQjeNM5e7rbgxpryOHYC9k1OIo9fYzyeYE'
    );

    const params = new URLSearchParams(window.location.search);
    const userId = params.get('user_id');

    if (!userId) {
      document.getElementById('cursos').innerHTML = `<strong>Erro:</strong> ID do aluno n√£o encontrado na URL.`;
      throw new Error('ID do aluno ausente na URL');
    }

    async function carregarAluno() {
      const { data, error } = await supabase
        .from('users')
        .select('name')
        .eq('id', userId)
        .single();

      if (data?.name) {
        document.getElementById('aluno-nome').textContent = data.name;
      }
    }

    async function carregarCursos() {
      const { data, error } = await supabase
        .from('user_courses')
        .select('course_id, courses (id, title, description)')
        .eq('user_id', userId);

      const container = document.getElementById('cursos');

      if (error || !data || data.length === 0) {
        container.innerHTML = `<p>Nenhum curso dispon√≠vel no momento.</p>`;
        return;
      }

      container.innerHTML = '';

      data.forEach(entry => {
        const curso = entry.courses;
        if (!curso) return;

        const card = document.createElement('section');
        card.innerHTML = `
          <h3>${curso.title}</h3>
          <p>${curso.description || 'Sem descri√ß√£o dispon√≠vel.'}</p>
          <a href="curso.html?user_id=${userId}&course_id=${curso.id}" class="contrast">Acessar curso</a>
        `;
        container.appendChild(card);
      });
    }

    carregarAluno();
    carregarCursos();
  </script>
</body>
</html>
