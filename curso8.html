<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aula</title>

  <!-- Tailwind CSS e Supabase -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Outfit', 'sans-serif'],
            display: ['Nunito', 'sans-serif']
          },
          colors: {
            primary: { 500: '#3B82F6', 600: '#2563EB', 700: '#1D4ED8' },
            surface: { 50: '#F8FAFC', 100: '#F1F5F9', 800: '#1E293B' },
            accent: { 400: '#38BDF8', 500: '#0EA5E9' }
          }
        }
      }
    };
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&family=Nunito:wght@700&display=swap" rel="stylesheet" />
</head>
<body class="font-sans bg-gradient-to-br from-surface-50 to-surface-100 text-gray-800 min-h-screen">

  <!-- Cabe√ßalho -->
  <header class="bg-primary-600 text-white h-14 flex items-center shadow-md">
    <div class="max-w-6xl mx-auto px-4 w-full flex justify-between items-center">
      <h1 class="text-xl font-display font-bold">Academy-Tools</h1>
      <span id="nomeAluno" class="text-sm font-medium truncate">Joana Silveira</span>
    </div>
  </header>

  <!-- Conte√∫do principal -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Coluna lateral -->
      <div class="lg:col-span-1">
        <div class="mb-6">
          <p class="text-sm mb-1">üìä Progresso do curso: <span id="textoProgresso">0%</span></p>
          <div class="w-full h-3 bg-gray-200 rounded">
            <div id="barraProgresso" class="h-3 bg-blue-600 rounded transition-all" style="width: 0%"></div>
          </div>
        </div>
        <h1 id="tituloCurso" class="text-2xl font-bold mb-2">Carregando curso...</h1>
        <p id="descricaoCurso" class="mb-4 text-gray-600 text-sm leading-relaxed"></p>
        <h2 class="font-semibold mb-2 flex items-center gap-2">üìö Aulas</h2>
        <ul id="listaAulas" class="list-none space-y-1 text-sm bg-white p-4 rounded shadow-sm border"></ul>
      </div>

      <!-- Coluna principal -->
      <div class="lg:col-span-2">

        <!-- Container do v√≠deo -->
        <div id="videoContainer" class="relative w-full pt-[56.25%] rounded overflow-hidden shadow mb-4">
          <div id="videoPlayer" class="absolute inset-0 w-full h-full z-0"></div>

          <!-- Overlay -->
          <div id="videoOverlay"
               class="absolute inset-0 z-10 bg-transparent pointer-events-auto cursor-not-allowed"
               title="Intera√ß√£o desabilitada durante o rastreamento">
          </div>

          <!-- Controles personalizados -->
          <div id="controlesCustomizados"
               class="hidden absolute bottom-0 left-0 w-full bg-black bg-opacity-80 text-white text-sm flex justify-between items-center px-4 py-2 z-20 rounded-b-md">

            <div class="flex items-center gap-3">
              <button onclick="retrocederVideo()" title="Voltar 10s">‚è™</button>
              <button onclick="togglePlayPause()" id="playPauseBtn"
                      class="bg-white text-black font-bold text-xs px-2 py-1 rounded hover:bg-gray-300 transition"
                      title="Reproduzir / Pausar">‚è∏Ô∏è</button>
              <button onclick="avancarVideo()" title="Avan√ßar 10s">‚è©</button>
              <span class="ml-3 text-white/80">Velocidade:</span>
              <button onclick="definirVelocidade(1)" class="hover:underline">1x</button>
              <button onclick="definirVelocidade(1.5)" class="hover:underline">1.5x</button>
              <button onclick="definirVelocidade(2)" class="hover:underline">2x</button>
            </div>

            <div id="infoControle" class="text-xs text-white/60 italic">
              Controles ativados
            </div>
          </div>
        </div>

        <!-- Detalhes -->
        <div class="flex flex-wrap items-center justify-between mb-3 gap-2">
          <h3 id="tituloAula" class="text-lg font-semibold">T√≠tulo da Aula</h3>
          <button id="btnQuiz" disabled class="bg-gray-300 text-gray-500 px-4 py-2 rounded text-sm cursor-not-allowed">
            Fazer Avalia√ß√£o da Aula
          </button>
        </div>

        <p class="text-xs text-gray-500">‚öôÔ∏è Progresso salvo automaticamente durante a reprodu√ß√£o</p>

        <div class="mt-3 space-y-1">
          <p id="progressoTexto" class="text-sm text-gray-700 flex items-center gap-2">
            ‚è± <span id="indicadorNumerico" class="text-blue-700 font-semibold animate-pulse"></span>
          </p>
          <p id="mensagemAluno" class="text-sm text-blue-700"></p>
          <p id="recomecarSugestao" class="text-sm text-blue-600 underline cursor-pointer hover:text-blue-800 transition"></p>
        </div>

      </div>
    </div>
  </main>

  <!-- JS funcional para os controles -->
  <script>
    function definirVelocidade(fator) {
      if (window.player && typeof window.player.setPlaybackRate === 'function') {
        window.player.setPlaybackRate(fator);
        document.getElementById("infoControle").textContent = `üîÅ Velocidade ajustada para ${fator}x`;
      }
    }

    function togglePlayPause() {
      const btn = document.getElementById("playPauseBtn");
      const estado = window.player.getPlayerState();
      if (estado === 1) {
        window.player.pauseVideo();
        btn.textContent = "‚ñ∂Ô∏è";
        document.getElementById("infoControle").textContent = "‚è∏Ô∏è V√≠deo pausado.";
      } else {
        window.player.playVideo();
        btn.textContent = "‚è∏Ô∏è";
        document.getElementById("infoControle").textContent = "‚ñ∂Ô∏è V√≠deo em reprodu√ß√£o.";
      }
    }

    function retrocederVideo() {
      const atual = window.player.getCurrentTime();
      window.player.seekTo(Math.max(0, atual - 10), true);
      document.getElementById("infoControle").textContent = "‚è™ Voltou 10 segundos";
    }

    function avancarVideo() {
      const atual = window.player.getCurrentTime();
      window.player.seekTo(atual + 10, true);
      document.getElementById("infoControle").textContent = "‚è© Avan√ßou 10 segundos";
    }

    function atualizarEstadoPlayPause() {
      const btn = document.getElementById("playPauseBtn");
      if (window.player && window.player.getPlayerState() === 1) {
        btn.textContent = "‚è∏Ô∏è";
      } else {
        btn.textContent = "‚ñ∂Ô∏è";
      }
    }

    function ativarControlesSeApto() {
      if (!window.player || typeof window.player.getCurrentTime !== 'function') return;
      const tempo = window.player.getCurrentTime();
      if (tempo >= 5) {
        const controles = document.getElementById("controlesCustomizados");
        if (controles && controles.classList.contains("hidden")) {
          controles.classList.remove("hidden");
          document.getElementById("infoControle").textContent = "üéÆ Controles ativados";
        }
      }
    }

    setInterval(() => {
      if (window.player && typeof window.player.getCurrentTime === 'function') {
        atualizarEstadoPlayPause();
        ativarControlesSeApto();
      }
    }, 1000);
  </script>
</body>
</html>
