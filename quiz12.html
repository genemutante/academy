// --- CONFIGURA√á√ÉO CLIENTE ---
const SUPABASE_URL = 'https://hiigckoowkrpewlybfef.supabase.co';
const SUPABASE_KEY = 'SUA_ANON_KEY_AQUI'; // <--- Verifique se esta chave est√° correta
const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// --- FUN√á√ÉO LOADQUIZ CORRIGIDA ---
async function loadQuiz() {
  const params = new URLSearchParams(window.location.search);
  const lessonId = params.get('lesson_id');
  const userId = params.get('user_id');

  console.log("üîç Iniciando carga do quiz para aula:", lessonId);

  if (!lessonId || lessonId === "false") {
    console.error("‚ùå ID da aula inv√°lido.");
    return;
  }

  try {
    // 1. Tenta buscar na tabela 'questions' (conforme sugest√£o do banco)
    // Se sua tabela for realmente 'quiz_questions', mude o nome abaixo
    const { data, error } = await _supabase
      .from('questions') 
      .select('*')
      .eq('lesson_id', lessonId)
      .order('order', { ascending: true });

    if (error) {
      // Se der erro de tabela n√£o encontrada, tenta o nome alternativo
      if (error.code === 'PGRST205') {
        const { data: retryData, error: retryError } = await _supabase
          .from('quiz_questions')
          .select('*')
          .eq('lesson_id', lessonId);
        
        if (retryError) throw retryError;
        questions = retryData;
      } else {
        throw error;
      }
    } else {
      questions = data;
    }

    if (!questions || questions.length === 0) {
      console.warn("‚ö†Ô∏è Nenhuma pergunta encontrada.");
      return;
    }

    renderStep(); // Chama a fun√ß√£o que mostra a primeira pergunta
  } catch (err) {
    console.error("‚ùå Erro fatal ao carregar quiz:", err.message);
  }
}

// Chame a fun√ß√£o no final do script
loadQuiz();
